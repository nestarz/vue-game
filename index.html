<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="./styles.css" />
  </head>
  <body>
    <div id="app"></div>
    <script defer src="./web_modules/es-module-shims.js"></script>
    <script defer type="module-shim">
      const vueCompile = (string) => {
        const script = /<script[^>]*>([^<]+)<\/script>/g.exec(string);
        const template = /<template[^>]*>([^9998199]+)<\/template>/gi.exec(string);
        return script[1].replace(
          "export default {",
          `export default { template: \`${template[1]}\`,`
        );
      };
      
      importShim.fetch = async function (url) {
        const response = await fetch(url);
        if (response.url.endsWith(".vue")) {
          const source = await response.text();
          const transformed = vueCompile(source);
          return new Response(
            new Blob([transformed], { type: "application/javascript" })
          );
        }
        return response;
      };
    </script>
    <script
      defer
      src="./web_modules/construct-style-sheets-polyfill.js"
    ></script>
    <script type="importmap-shim" src="./web_modules/import-map.json"></script>
    <script type="importmap-shim" src="./src/game/src/import-map.json"></script>
    <script
      type="importmap-shim"
      src="./src/cannon-worker/src/import-map.json"
    ></script>
    <script
      type="importmap-shim"
      src="./src/vue-cannon/src/import-map.json"
    ></script>
    <script
      type="importmap-shim"
      src="./src/vue-three-fiber/src/import-map.json"
    ></script>
    <script type="module-shim" src="./src/game/src/index.js"></script>
  </body>
</html>
